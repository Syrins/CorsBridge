# ========== CORE RUNTIME ==========
# TR: Bu bölüm canlı sunucunun temel ayarlarını tutar.
# EN: These values define the base runtime for the live server.

# NODE_ENV
# TR: Canlı ortam olduğu için production yazılı kalmalı.
# EN: Keep production so logs/metrics mark this instance as live.
NODE_ENV=production

# SERVICE_NAME
# TR: Loglarda ve metriklerde gözükecek kısa isim.
# EN: Human-friendly name that surfaces in logs/metrics.
SERVICE_NAME=corsbridge-backend

# LOG_LEVEL
# TR: Canlıda info/warn yeterli; gereksiz detay çıkmasın.
# EN: Info keeps production logs concise (use debug only for deep troubleshooting).
LOG_LEVEL=info

# PORT
# TR: Reverse proxy bu porta bağlanacak.
# EN: Port exposed to load balancers or Kubernetes services.
PORT=3000

# HOST
# TR: 0.0.0.0 bırakınca makinedeki tüm arayüzleri dinler.
# EN: 0.0.0.0 binds every interface so the service is reachable from anywhere.
HOST=0.0.0.0

# HELP_FILE
# TR: Yardım uç noktasında okunacak dosya yolu.
# EN: File served when someone hits the help endpoint.
HELP_FILE=./lib/help.txt

# SHOW_HELP_ON_ROOT
# TR: Prod’da kök URL’de yardım metni göstermemek için false.
# EN: Hide the help text on / for production security hygiene.
SHOW_HELP_ON_ROOT=false

# PROXY_VERSION
# TR: X-Proxy-Version başlığında gözükecek sürüm etiketi.
# EN: Value echoed in X-Proxy-Version so ops can see which build is deployed.
PROXY_VERSION=1.0.0

# MEMORY_RESTART_THRESHOLD_MB
# TR: Bellek 512 MB’ı geçerse süreç kibarca yeniden başlasın.
# EN: Graceful restart threshold (megabytes) to contain leaks.
MEMORY_RESTART_THRESHOLD_MB=512

# MEMORY_GUARD_INTERVAL_MS
# TR: Bellek bekçisi kaç milisaniyede bir kontrol edecek.
# EN: Frequency of the memory watchdog loop.
MEMORY_GUARD_INTERVAL_MS=60000


# ========== NETWORK & PROXY ==========
# TR: Trafiği yöneten ayarları burada topladık.
# EN: These knobs control connection pooling and proxy behavior.

# MAX_SOCKETS
# TR: Aynı anda açık tutulacak bağlantı sayısı (yüksek trafik için 200 iyi).
# EN: Concurrent sockets allowed in the shared agents.
MAX_SOCKETS=200

# MAX_FREE_SOCKETS
# TR: Sıcak tutulan boş bağlantılar; 50 yeterli tampon.
# EN: Idle sockets kept around for quick reuse.
MAX_FREE_SOCKETS=50

# MAX_CACHED_SESSIONS
# TR: TLS oturum önbelleğini kapatmak için 0 bırakıyoruz (EPROTO hatalarını önler).
# EN: Disable TLS session reuse to avoid upstream invalid-session errors.
MAX_CACHED_SESSIONS=0

# PROXY_REJECT_UNSECURE
# TR: HTTPS sertifikaları doğrulansın; canlıda her zaman true.
# EN: Always verify upstream TLS certificates in production.
PROXY_REJECT_UNSECURE=true

# ENABLE_REDIRECTS
# TR: CDN ve yönlendirmeleri takip etmek için açık kalsın.
# EN: Allow the proxy to follow upstream redirects.
ENABLE_REDIRECTS=true

# PROXY_ALLOWED_METHODS
# TR: İzin verilen HTTP metodlarının listesi.
# EN: Whitelisted HTTP verbs forwarded upstream.
PROXY_ALLOWED_METHODS=GET,HEAD,POST,PUT,PATCH,DELETE,OPTIONS

# PROXY_OPTIONS_PASSTHROUGH
# TR: Preflight OPTIONS istekleri burada cevaplanır; upstream’e yollamayın.
# EN: Handle OPTIONS locally for faster CORS responses.
PROXY_OPTIONS_PASSTHROUGH=false

# PROXY_PASSTHROUGH_ORIGIN
# TR: Origin/Referer gizliliği için false bırakın.
# EN: Do not leak client Origin/Referer headers unless upstream needs them.
PROXY_PASSTHROUGH_ORIGIN=false

# PROXY_PRESERVE_HOST_HEADER
# TR: Hedef servis orijinal Host beklemiyorsa false kalsın.
# EN: Rewrite Host to the upstream host name (true only if required).
PROXY_PRESERVE_HOST_HEADER=false

# PROXY_STRIP_HEADERS
# TR: Hop-by-hop başlıkları kaldıran güvenli liste.
# EN: Headers removed before forwarding requests.
PROXY_STRIP_HEADERS=accept-encoding,connection,keep-alive,proxy-authorization,proxy-authenticate,te,trailer,transfer-encoding,upgrade,via

# PROXY_EXPOSE_HEADERS
# TR: Tarayıcıya göstereceğimiz yanıt başlıkları.
# EN: Headers exposed through Access-Control-Expose-Headers.
PROXY_EXPOSE_HEADERS=traceparent,x-request-id,x-proxy-cache,x-cache-status,x-circuit-breaker

# PROXY_MAX_UPSTREAM_AGENTS
# TR: Kaç farklı CONNECT ajanının cache’te tutulacağı.
# EN: Cap on cached upstream proxy agents.
PROXY_MAX_UPSTREAM_AGENTS=200

# PROXY_UPSTREAM_AGENT_TTL_MS
# TR: Bu ajanlar kaç ms sonra temizlenecek.
# EN: TTL for cached upstream agents (milliseconds).
PROXY_UPSTREAM_AGENT_TTL_MS=900000

# MAX_REDIRECTS
# TR: Redirect zinciri 5 adımı geçmesin.
# EN: Safety limit for redirect chains.
MAX_REDIRECTS=5


# ========== SECURITY & PAYLOAD ==========
# TR: Boyut ve zaman aşımı sınırları DoS risklerini azaltır.
# EN: Size/time limits that keep the proxy safe.

# MAX_URL_LENGTH
# TR: Proxylenebilecek URL’nin karakter sınırı.
# EN: Requests with longer URLs are rejected.
MAX_URL_LENGTH=4096

# MAX_REQUEST_SIZE
# TR: Gelen gövde 10 MB’ı geçerse istek reddedilir.
# EN: Upper bound for inbound payloads.
MAX_REQUEST_SIZE=10mb

# MAX_RESPONSE_SIZE
# TR: Upstream’den gelen yanıt da 10 MB ile sınırlı.
# EN: Prevents someone from streaming huge files through the proxy.
MAX_RESPONSE_SIZE=10mb

# MAX_JSON_BODY_SIZE
# TR: JSON gövde limiti (bayt cinsinden 1 MB).
# EN: Protects body validator from giant JSON blobs.
MAX_JSON_BODY_SIZE=1048576

# MAX_TEXT_BODY_SIZE
# TR: Düz metin limiti (aynı şekilde 1 MB).
# EN: Text payload guardrail for forms/plain endpoints.
MAX_TEXT_BODY_SIZE=1048576

# MAX_HEADER_SIZE
# TR: HTTP başlıklarının toplam byte limiti.
# EN: Node server rejects requests with bigger header blocks.
MAX_HEADER_SIZE=16384

# REQUEST_TIMEOUT
# TR: Upstream yanıtı 30 sn içinde gelmeli.
# EN: Milliseconds before the proxy aborts slow targets.
REQUEST_TIMEOUT=30000

# KEEP_ALIVE_TIMEOUT
# TR: Keep-alive süresi timeout’tan biraz uzun olmalı (31 sn).
# EN: Must stay above REQUEST_TIMEOUT to avoid premature closes.
KEEP_ALIVE_TIMEOUT=31000

# HEADERS_TIMEOUT
# TR: Başlıkların tamamı gelmezse 32 sn’de soketi kapat.
# EN: Gives Node enough time to read late headers.
HEADERS_TIMEOUT=32000


# ========== CORS POLICY ==========
# TR: Tarayıcı erişimini sıkı tutarak yalnızca gerçek frontend’leri kabul edin.
# EN: Lock this down so random origins cannot abuse the proxy.

# CORS_ALLOWED_ORIGINS
# TR: Canlı frontend kök URL’lerini virgülle yazın (wildcard yok).
# EN: Examples: https://app.example.com,https://beta.example.com.
CORS_ALLOWED_ORIGINS=https://app.example.com,https://beta.example.com

# CORS_ALLOW_CREDENTIALS
# TR: Kimlik bilgisi taşıyan istekleri kabul etmek istiyorsanız true yapın.
# EN: Leave false unless you must forward cookies/headers from browsers.
CORS_ALLOW_CREDENTIALS=false

# CORS_ALLOWED_HEADERS
# TR: Varsayılan header listesi; gerekirse özel header ekleyin.
# EN: Matches src/config/cors.config.ts defaults plus cache headers.
CORS_ALLOWED_HEADERS=accept,content-type,authorization,x-requested-with,x-trace-id,traceparent,x-proxy-cache,cache-control,pragma

# CORS_ALLOWED_METHODS
# TR: Proxy’nin desteklediği HTTP metodları.
# EN: Keep OPTIONS included for smooth preflights.
CORS_ALLOWED_METHODS=GET,HEAD,POST,PUT,PATCH,DELETE,OPTIONS

# CORS_EXPOSE_HEADERS
# TR: Tarayıcıların okuyabileceği yanıt üstbilgileri.
# EN: Useful for tracing IDs surfaced back to the UI.
CORS_EXPOSE_HEADERS=traceparent,x-request-id,x-proxy-cache

# CORS_MAX_AGE
# TR: Preflight sonuçları ne kadar süre cachelensin (saniye).
# EN: 86400 = 1 gün; kısaltmak isterseniz burayı düşürün.
CORS_MAX_AGE=86400

# SEND_POWERED_BY_HEADER
# TR: Güvenlik için prod’da false; marka görünürlüğü istiyorsanız true.
# EN: Only enable if you accept leaking implementation details.
SEND_POWERED_BY_HEADER=false


# ========== CACHING & DNS ==========
# TR: CDN benzeri davranış için bu ayarları kullanın.
# EN: Tune cache knobs to relieve upstream services.

# ENABLE_CACHE
# TR: Yanıt cache’i açıksa popüler istekler hafızadan döner.
# EN: Disable if upstream responses must always be fresh.
ENABLE_CACHE=true

# CACHE_TTL
# TR: Cachelenen bir kayıt 300 sn boyunca geçerli.
# EN: Seconds before a cache hit becomes stale.
CACHE_TTL=300

# CACHE_MAX_SIZE
# TR: En fazla 500 kayıt sakla; yüksek trafikte artırabilirsiniz.
# EN: Set to 0 if caching should be fully disabled.
CACHE_MAX_SIZE=500

# CACHE_MAX_BODY_SIZE
# TR: 10 MB’tan büyük yanıtlar cache’e girmesin.
# EN: Provide value with unit (b/kb/mb/gb).
CACHE_MAX_BODY_SIZE=10mb

# DNS_CACHE_TTL_MS
# TR: DNS sonuçları 60 sn tutulur; dinamik hedefler için düşürün.
# EN: Milliseconds per cached lookup in utils/sanitizer.ts.
DNS_CACHE_TTL_MS=60000


# ========== RATE LIMIT & ABUSE ==========
# TR: Trafik patlamalarını kontrol etmek için oran limitlerini kullanın.
# EN: Prevent single clients from hogging the proxy.

# RATE_LIMIT_WINDOW_MS
# TR: Kaydırmalı pencere uzunluğu (10 dk = 600000 ms).
# EN: Pick a window that matches your business quotas.
RATE_LIMIT_WINDOW_MS=600000

# RATE_LIMIT_MAX_REQUESTS
# TR: Her pencere için izin verilen çağrı sayısı.
# EN: Lower this to clamp aggressive clients.
RATE_LIMIT_MAX_REQUESTS=200

# RATE_LIMIT_DAILY_LIMIT
# TR: Günlük üst sınır (0 ise devre dışı).
# EN: Good for public endpoints with fair-use policies.
RATE_LIMIT_DAILY_LIMIT=2000

# RATE_LIMIT_SKIP_FAILED / RATE_LIMIT_SKIP_SUCCESS / RATE_LIMIT_SKIP_OPTIONS
# TR: Hangi isteklerin kotayı tüketmeyeceğini seçin.
# EN: OPTIONS veya hata yanıtlarını dışarıda bırakmak için true yapın.
RATE_LIMIT_SKIP_FAILED=false
RATE_LIMIT_SKIP_SUCCESS=false
RATE_LIMIT_SKIP_OPTIONS=false

# RATE_LIMIT_WHITELIST
# TR: Rate limit’e takılmaması gereken IP/CIDR listesi.
# EN: Keep internal ranges private; comma separated.
RATE_LIMIT_WHITELIST=

# ABUSE_WARN_THRESHOLD / ABUSE_ALERT_THRESHOLD
# TR: Kötüye kullanım monitörünün uyarı ve alarm rakamları.
# EN: Trigger notifications when origins exceed healthy usage.
ABUSE_WARN_THRESHOLD=500
ABUSE_ALERT_THRESHOLD=1000

# ABUSE_DETECTION
# TR: Tüm kötüye kullanım izlemeyi tek tuşla kapatır.
# EN: Leave true unless another system replaces it.
ABUSE_DETECTION=true


# ========== REDIS & STORES ==========
# TR: Dağıtık rate limit gerekiyorsa Redis’i açın.
# EN: Local-only deployments can leave this off.

# ENABLE_REDIS
# TR: true yapınca limiter RedisStore kullanır; false ise süreç içi hafıza.
# EN: Flip on only when REDIS_URL is reachable.
ENABLE_REDIS=false

# REDIS_URL
# TR: redis://user:pass@host:6379/0 formatında, sır olarak yönetin.
# EN: Do not commit real credentials; rotate per environment.
REDIS_URL=redis://user:pass@localhost:6379/0


# ========== ORIGIN ANALYTICS ==========
# TR: Hangi domainlerin proxy’yi kullandığını ölçmek için.
# EN: Helpful for abuse detection and traffic insights.

# TRACK_ORIGINS / ORIGIN_TRACK_TOP / ORIGIN_TRACK_USAGE
# TR: Hepsini true tutarsanız sıralı ve davranışsal raporlar üretir.
# EN: Turn any of them off if privacy policies forbid tracking.
TRACK_ORIGINS=true
ORIGIN_TRACK_TOP=true
ORIGIN_TRACK_USAGE=true

# ORIGIN_WARN_THRESHOLD / ORIGIN_ALERT_THRESHOLD
# TR: Günlük çağrı sayısı bu rakamları aşarsa uyarı/alarm gönderilir.
# EN: Adjust per plan size (e.g., 10k warn, 50k alert).
ORIGIN_WARN_THRESHOLD=10000
ORIGIN_ALERT_THRESHOLD=50000

# ORIGIN_AUTO_BLOCK / ORIGIN_BLOCK_LIST
# TR: Belirli originleri otomatik engellemek istiyorsanız buradan yönetin.
# EN: Provide comma-separated URLs when auto block is enabled.
ORIGIN_AUTO_BLOCK=false
ORIGIN_BLOCK_LIST=


# ========== CIRCUIT BREAKER ==========
# TR: Arızalı upstream’i otomatik izole etmek için devre kesici.
# EN: Stops repeated failures from piling up.

# CIRCUIT_BREAKER_FAILURE_THRESHOLD
# TR: 5 ardışık hata devreyi açar.
# EN: Increase if upstreams are flaky but acceptable.
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# CIRCUIT_BREAKER_SUCCESS_THRESHOLD
# TR: 2 başarılı deneme devreyi kapatır.
# EN: Higher values require more proof before reopening.
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2

# CIRCUIT_BREAKER_TIMEOUT_MS
# TR: Devre açıkken 60 sn bekle, sonra yarı açık dene.
# EN: Milliseconds spent cooling off.
CIRCUIT_BREAKER_TIMEOUT_MS=60000

# CIRCUIT_BREAKER_WINDOW_MS
# TR: Hata sayacı bu pencere içinde değerlendirilir (120 sn).
# EN: Pick a window that reflects recent health.
CIRCUIT_BREAKER_WINDOW_MS=120000

# CIRCUIT_BREAKER_MAX_TARGETS
# TR: Aynı anda en fazla 1000 upstream için durum sakla.
# EN: Keep modest to limit memory footprint.
CIRCUIT_BREAKER_MAX_TARGETS=1000

# CIRCUIT_BREAKER_TTL_MS
# TR: Kullanılmayan devreler 30 dk sonra temizlenir.
# EN: Milliseconds before idle circuit state is pruned.
CIRCUIT_BREAKER_TTL_MS=1800000


# ========== OBSERVABILITY ==========
# TR: Metrik kartları ve Prometheus çıktısı için sınırlar.
# EN: Keeps monitoring memory usage predictable.

# METRICS_MAX_TARGETS
# TR: Aynı anda izlenecek en fazla hedef sayısı (200 iyi varsayılan).
# EN: Raise if you mirror hundreds of upstream hosts.
METRICS_MAX_TARGETS=200

# METRICS_MAX_RESPONSE_SAMPLES
# TR: Yanıt süresi örnek havuzunun büyüklüğü.
# EN: Higher values smooth latency percentiles but use more RAM.
METRICS_MAX_RESPONSE_SAMPLES=10000
